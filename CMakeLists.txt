cmake_minimum_required(VERSION 3.15)

### So we can install without building everything (docs, examples and tests)
set(CMAKE_SKIP_INSTALL_ALL_DEPENDENCY TRUE)


### Get major.minor.patch semantic version
file(READ include/handy/Helpers/Config.h handy_config_file)

string(REGEX MATCH "define[ \t]+HANDY_MAJOR_VERSION[ \t]+([0-9]+)" handy_major_version_match ${handy_config_file})
set(handy_major_version "${CMAKE_MATCH_1}")

string(REGEX MATCH "define[ \t]+HANDY_MINOR_VERSION[ \t]+([0-9]+)" handy_minor_version_match ${handy_config_file})
set(handy_minor_version "${CMAKE_MATCH_1}")

string(REGEX MATCH "define[ \t]+HANDY_PATCH_VERSION[ \t]+([0-9]+)" handy_patch_version_match ${handy_config_file})
set(handy_patch_version "${CMAKE_MATCH_1}")

set(handy_version ${handy_major_version}.${handy_minor_version}.${handy_patch_version})
###


### Create the project with the given version
project(handy VERSION ${handy_version} LANGUAGES CXX)


### Options
option(HANDY_BuildTests "If the unit test will be generated by cmake" OFF)

option(HANDY_BuildExamples "If the examples will be generated by cmake" OFF)

option(HANDY_BuildDocs "If the docs will be generated by cmake" OFF)
###



### Add library
add_library(handy INTERFACE)

#add_library(handy::handy ALIAS handy)

target_compile_features(handy INTERFACE cxx_std_17)
###


target_include_directories(handy INTERFACE
    $<BUILD_INTERFACE:${PROJECT_SOURCE_DIR}/include/handy>
    $<INSTALL_INTERFACE:${CMAKE_CURRENT_BINARY_DIR}/include/handy>
)


if(HANDY_BuildTests AND NOT TARGET tests)
    add_subdirectory(tests)
endif()

if(HANDY_BuildExamples AND NOT TARGET examples)
    add_subdirectory(examples)
endif()

if(HANDY_BuildDocs AND NOT TARGET doc)
    add_subdirectory(doc)
endif()



# include(CMakePackageConfigHelpers)

# write_basic_package_version_file(
#     ${CMAKE_CURRENT_BINARY_DIR}/HandyConfigVersion.cmake COMPATIBILITY SameMajorVersion
# )

# configure_package_config_file(
#     "cmake/config.cmake.in"
#     ${NLOHMANN_JSON_CMAKE_PROJECT_CONFIG_FILE}
#     INSTALL_DESTINATION ${NLOHMANN_JSON_CONFIG_INSTALL_DIR}
# )

if(NOT HANDY_INCLUDE_INSTALL_DIR)
    if(INCLUDE_INSTALL_DIR)
        set(HANDY_INCLUDE_INSTALL_DIR ${INCLUDE_INSTALL_DIR})
    else()
        set(HANDY_INCLUDE_INSTALL_DIR ${CMAKE_INSTALL_PREFIX}/include)
    endif()
endif()


install(
    DIRECTORY ${PROJECT_SOURCE_DIR}/include/handy
    DESTINATION ${HANDY_INCLUDE_INSTALL_DIR}/handy
)
